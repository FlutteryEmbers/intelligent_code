# Python Language Profile
# QA/Design generation rules and parsing configuration for Python projects

language: python

# System prompts for training data export
system_prompts:
  default: |
    你是一个专业的代码助手，精通 Python 开发和架构设计。
    你的任务是根据提供的代码上下文，准确回答问题或提供设计方案。
    你必须基于 evidence（证据）进行推理，确保答案可追溯到具体代码。
    在回答时，注重实用性和可操作性，避免过于抽象的描述。
  reasoning: |
    你是一个专业的代码助手，精通 Python 开发和架构设计。
    你的任务是根据提供的代码上下文，准确回答问题或提供设计方案。
    在回答时，请先展示你的推理过程，然后给出最终答案。

# Answer Generation Configuration
answer_generation:
  # JSON格式约束说明
  format_constraints: |
    ## CRITICAL: JSON格式要求
    
    1. **context字段必须是字符串（string）**，不能是数组或对象
       - 使用 \n 表示换行
       - 所有代码片段合并为一个字符串
       - 示例: "context": "def authenticate(user):\\n    ..."
    
    2. **字符串转义规则**
       - 所有字符串用双引号包裹
       - 字符串内的双引号必须转义：\\"
       - 换行符使用 \\n 而不是实际换行
    
    3. **evidence_refs格式**
       - 必须是对象数组
       - 每个对象必须包含全部5个字段：symbol_id, file_path, start_line, end_line, source_hash
       - 必须从"可用证据引用"列表中精确复制，不要修改任何值
  
  # 常见错误示例
  common_mistakes:
    - type: "context_as_list"
      description: "context使用数组而不是字符串"
      wrong: |
        "context": [{"symbol_id": "...", "code": "def authenticate(user): ..."}]
      correct: |
        "context": "def authenticate(user):\\n    # Verify user credentials\\n    if not user.check_password(password):\\n        raise AuthenticationError()\\n    return generate_token(user)"
    
    - type: "missing_escape"
      description: "字符串内的双引号未转义"
      wrong: |
        "answer": "方法使用了\"Django认证系统\"来验证用户"
      correct: |
        "answer": "方法使用了\\\"Django认证系统\\\"来验证用户"
    
    - type: "incomplete_evidence"
      description: "evidence_refs缺少必需字段"
      wrong: |
        "evidence_refs": [{"symbol_id": "views.py:authenticate:12"}]
      correct: |
        "evidence_refs": [{
          "symbol_id": "Backend/authentication/views.py:views.authenticate:12",
          "file_path": "Backend/authentication/views.py",
          "start_line": 12,
          "end_line": 35,
          "source_hash": "abc123def456..."
        }]

# Parsing Configuration: File extensions, ignore patterns, and parser settings
parsing:
  # File extensions to parse
  file_extensions:
    - ".py"
    - ".pyi"   # Type stub files
  
  # Paths to ignore during parsing
  ignore_paths:
    - "test"
    - "tests"
    - ".git"
    - "venv"          # Virtual environment
    - "env"
    - ".venv"
    - "__pycache__"   # Python cache
    - ".pytest_cache"
    - ".tox"
    - "dist"          # Distribution builds
    - "build"
    - "*.egg-info"
    - ".idea"
    - ".vscode"
    - "node_modules"
  
  # Parser-specific settings
  max_chars_per_symbol: 8000    # Python code is typically more concise
  include_private: false          # Skip methods starting with _
  include_test: false

# QA Generation: Candidate selection and scoring rules
qa:
  markers:
    # Java annotations (not used in Python)
    annotations: []
    # Python decorators that indicate business logic
    decorators:
      - route
      - get
      - post
      - put
      - delete
      - patch
      - api_view
      - action
      - task
      - cached_property
      - transaction
      - atomic
    # Keywords in function/class names
    name_keywords:
      - process
      - handle
      - execute
      - validate
      - calculate
      - transform
      - create
      - update
      - delete
    # Keywords in file paths
    path_keywords:
      - views
      - routers
      - handlers
      - services
      - controllers
  
  scoring:
    # Weight for Java annotations (not applicable)
    annotation_weight: 0
    # Weight for having decorators
    decorator_weight: 10
    # Weight for having documentation
    doc_weight: 5
    # Weight for matching name keywords
    name_keyword_weight: 1

# Design Generation: Layer identification rules
design:
  layers:
    controller:
      annotations: []
      decorators:
        - route
        - get
        - post
        - put
        - delete
        - patch
        - api_view
        - action
      name_keywords:
        - view
        - router
        - controller
        - endpoint
        - api
      path_keywords:
        - views
        - routers
        - controllers
        - api
        - endpoints
    
    service:
      annotations: []
      decorators:
        - transaction
        - atomic
        - cached_property
      name_keywords:
        - service
        - manager
        - handler
        - processor
        - usecase
      path_keywords:
        - services
        - business
        - logic
        - usecases
    
    repository:
      annotations: []
      decorators: []
      name_keywords:
        - repository
        - dao
        - store
        - model
      path_keywords:
        - repositories
        - models
        - dao
        - database
        - persistence
