# Architecture Design Questions Configuration
# 用于生成架构设计方案的设计问题定义

design_questions:
  - id: "DQ-001"
    goal: "为用户登录接口添加 Redis 缓存层，提升高并发场景下的性能"
    constraints:
      - "使用 Redis 作为缓存存储"
      - "缓存有效期为 30 分钟"
      - "需要保证缓存与数据库数据一致性"
      - "需要支持缓存预热和失效策略"
    acceptance_criteria:
      - "登录 QPS 提升 5 倍以上"
      - "缓存命中率 > 90%"
      - "缓存穿透/雪崩有防护机制"
      - "支持缓存手动刷新"
    non_goals:
      - "不改变现有登录业务逻辑"
      - "不引入分布式锁（MVP 阶段）"

  - id: "DQ-002"
    goal: "为订单创建接口实现幂等性保证，防止重复下单"
    constraints:
      - "使用唯一业务流水号作为幂等标识"
      - "幂等信息需要持久化"
      - "幂等检查失败时返回明确错误"
      - "支持幂等信息过期清理"
    acceptance_criteria:
      - "相同流水号的重复请求返回相同结果"
      - "幂等检查响应时间 < 10ms"
      - "幂等信息保留 24 小时"
      - "支持幂等状态查询接口"
    non_goals:
      - "不处理分布式事务回滚"
      - "不实现全局唯一 ID 生成器"

  - id: "DQ-003"
    goal: "为产品查询接口实现读写分离，提升查询性能"
    constraints:
      - "主库负责写操作，从库负责读操作"
      - "需要处理主从延迟问题"
      - "从库故障时自动切换到主库"
      - "支持手动指定读主库"
    acceptance_criteria:
      - "读请求 > 95% 走从库"
      - "主从延迟 < 1 秒"
      - "从库故障切换时间 < 3 秒"
      - "提供监控指标（主从延迟、读写比例）"
    non_goals:
      - "不实现自动主从切换（依赖 DBA）"
      - "不支持多从库负载均衡（MVP 阶段）"

  - id: "DQ-004"
    goal: "为商品搜索接口添加限流保护，防止恶意刷单"
    constraints:
      - "基于用户 ID 和 IP 的双重限流"
      - "使用令牌桶算法"
      - "限流阈值可配置"
      - "限流触发时返回 429 状态码"
    acceptance_criteria:
      - "单用户 QPS 限制在 10 次/秒"
      - "单 IP QPS 限制在 100 次/秒"
      - "限流信息存储在 Redis"
      - "提供限流白名单功能"
    non_goals:
      - "不实现分布式限流（单机版）"
      - "不记录限流日志到数据库"

  - id: "DQ-005"
    goal: "为用户收藏夹功能添加异步处理，优化响应时间"
    constraints:
      - "使用消息队列（RabbitMQ/Kafka）"
      - "收藏操作立即返回，后台异步处理"
      - "需要保证最终一致性"
      - "失败重试 3 次"
    acceptance_criteria:
      - "接口响应时间 < 100ms"
      - "消息处理成功率 > 99.9%"
      - "失败消息进入死信队列"
      - "提供收藏状态查询接口"
    non_goals:
      - "不实现消息顺序保证"
      - "不支持事务消息（MVP 阶段）"
